= {subject} [black]*Ansible For Network Engineers*
TheNetwork.Engineer
:subject:
:description:
:doctype:
:confidentiality:
:listing-caption: Listing
:toc:
:toclevels: 6
:sectnums:
:chapter-label:
:icons: font
ifdef::backend-pdf[]
:pdf-page-size: A4
:source-highlighter: rouge
:rouge-style: github
endif::[]







[red big]*Using pyATS and Genie with Ansible*

Cisco has released two Python3 libraries that are very useful for network automation pyATS & Genie. pyATS functions as a framework while genie builds on top of it, Genie can be used to parse, learn, and diff.
This blog will cover using the parsers that are made available in the Genie library. We will do that by calling a role in our playbook by the name parse_genie.

The role can be found https://galaxy.ansible.com/clay584/parse_genie[here] on Galaxy.

This role was graciously created by Clay Curtis @ccurtis584

image:images/clay.jpg[]

This plugin will require Python 3.4+ and you need to pip install the pyATS and Genie packages as well.


pyATS | Genie v19.5 has been released with 60 new parsers supporting IOS/IOSXE/XR/NXOS!
It contains 1129 full parsers listed here...
https://pubhub.devnetcloud.com/media/pyats-packages/docs/genie/genie_libs/#/parsers


Let me show you my idea of how this role would be used.

We need to invoke the role at the beginning of the playbook so we
can use the filter plugin in a later task.

We then need to execute show command and register the output to a variable.

Now run the text obtained via out show command through the filter plugin, it will then return to us structured data in JSON.
We can programmatically use our parsed data very easily.




[source,yaml]
----
---
- name: pyATS testing
  hosts: ios
  gather_facts: no
  connection: network_cli
  roles:
    - parse_genie

  tasks:

  - name: Run the show version command
    ios_command:
      commands:
        - show version
    register: version

  - name: Set fact with Genie filter plugin
    set_fact:
      pyats_version: "{{ version['stdout'][0] | parse_genie(command='show version', os='ios') }}"

  - name: Debug pyATS facts - all
    debug:
     var: pyats_version.version

  - name: Debug pyATS facts - version
    debug:
     var: pyats_version.version.version

  - name: Debug pyATS facts - uptime
    debug:
     var: pyats_version.version.uptime
----


image:images/demo.gif[]


[black big]*Data Model*






[black big]*Stay tuned for more blogs*




|===
|===


|===

|===
TheNetwork.Engineer - June 16 2019  -  Colin McCarthy
|===
