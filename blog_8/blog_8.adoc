= {subject} [black]*Ansible Linting with GitHub Actions*
TheNetwork.Engineer
:subject:
:description:
:doctype:
:confidentiality:
:listing-caption: Listing
:toc:
:toclevels: 6
:sectnums:
:chapter-label:
:icons: font
ifdef::backend-pdf[]
:pdf-page-size: A4
:source-highlighter: rouge
:rouge-style: github
endif::[]










[black big]*Ansible-lint*

Ansible-lint is an open-source project that lints your Ansible code. The Docs state
that it checks playbooks for practices and behavior that could potentially be improved.
It can be installed with pip and run manually on single playbooks or set up in a pre-commit hook and ran when you attempt a
commit on your repo from the CLI.


The project can be found under the Ansible org on GitHub.

https://github.com/ansible/ansible-lint



[black big]*GitHub Actions*

GitHub Actions enables you to create custom workflows directly in your GitHub repository.

One day I was on Twitter and noticed an Ansible-lint action was created by Stefan St√∂lzle.


It can be found here on GitHub's actions marketplace.

https://github.com/marketplace/actions/ansible-lint?version=v4.1.0



[black big]*My Ansible network repo*

Let me  show you an example of what this would look like in production.
Here I have a repo that has some Ansible playbooks for converting CSV files into  Cisco commands.
There are some ASA firewall rules and some BGP peering commands etc..

https://github.com/colin-mccarthy/ansible_csv

I attempted to submit a pull request to make a change to one of the playbooks. The Ansible-lint Action kicked off
and eventually detected an issue and returned a failed message, the pull request did not get successfully submitted.









image:images/failed.jpeg[]

I received an email notification as well, letting me know it had failed.


image:images/email.jpeg[]





[black big]*Setting it up*


To use the action simply create an ansible-lint.yml (or choose custom *.yml name) in the [red]#.github/workflows/# directory.






```
workflow "Ansible Lint" {
 on = "pull_request"
 resolves = ["Lint Ansible Playbook"]
}

action "Lint Ansible Playbook" {
  uses = "ansible/ansible-lint-action@v4.1.0"
}
```

You can run the action on various events:

```
on = "push, pull_request"
```



image:images/workflow.jpeg[]










[black big]*Pre Commit hooks*

I would like to go a little deeper into linting by bringing up pre-commit hooks.

Pre-commit hooks are little scripts ran locally on your machine, that can help identify issues before submission for code review.
So when talking about the Ansible-lint action, it would really come in handy to lint the code before you submit your pull request.
This would make sure you always pass. The GitHub action would just serve as the final step that guards the shared repo.
If your using pre-commit hooks you should hypothetically never fail the gitHub action test.

https://pre-commit.com

To set this up on my MacBook I simply did a pip install.


```
pip install pre-commit
```
To set it up on your repo just make sure you...


```
pre-commit install
```

image:images/lint.gif[]




[black big]*Final thoughts*


This is a great way to get started with Actions if you are using GitHub as your flavor of SCM.







|===
|===


|===

|===
TheNetwork.Engineer - Nov 24 2019  -  Colin McCarthy
|===
