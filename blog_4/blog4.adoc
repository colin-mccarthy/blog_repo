= {subject} [black]*Ansible For Network Engineers*
TheNetwork.Engineer
:subject:
:description:
:doctype: book
:confidentiality:
:listing-caption: Listing
:toc:
:toclevels: 6
:sectnums:
:chapter-label:
:icons: font
ifdef::backend-pdf[]
:pdf-page-size: A4
:source-highlighter: rouge
:rouge-style: github
endif::[]



|===

image:images/ansible.jpg[]


[red big]*Utilize Ansible for opening and closing tickets with ServiceNow - Part 4.*

Here are links to  https://www.thenetwork.engineer/blog/utilize-ansible-for-opening-and-closing-tickets-with-servicenow[Part 1]
, https://www.thenetwork.engineer/blog/utilize-ansible-for-opening-and-closing-tickets-with-servicenow-part2[Part 2]
, and https://www.thenetwork.engineer/blog/utilize-ansible-for-opening-and-closing-tickets-with-servicenow-part3[Part 3]

This article is part four in a series covering the role Ansible can play in ticket automation.
This time we'll cover creating and managing a reusable and scalable role.


This blog post will cover my journey in creating and managing an open-source Ansible role for creating ServiceNow network tickets.
The role can be found https://galaxy.ansible.com/colin_mccarthy/servicenow_network_tickets[here] on Galaxy.

I will cover the tools and best practices I used while maintaining the https://github.com/colin-mccarthy/servicenow_network_tickets[GitHub] repo.

Including the https://www.atlassian.com/git/tutorials/comparing-workflows/gitflow-workflow[GitFlow] process for making changes to the role and merging between dev and master branches.

But first... let me show you my idea of how this role would be used in a production network.

```



[black big]*GitFlow*

While I developed this role on my own I still wanted to hold myself to using Git collaboration best practices. I used the GitFlow workflow for all changes to the code. I created a [red]#devel# branch and worked in there for all my testing and additions to the codebase. Once I had something new or a bug fix figured out and was happy with it, I created a Pull request against the [red]#master# branch. If you ever have a chance to contribute to the open-source Ansible project on GitHub you will follow the same processes of forking and creating pull requests.

Learning this flow is the most important things you can do to embrace and benefit from these developer tools our field is moving towards adopting. When you are working on a code project with other people who are also contributing this flow becomes imperative. Learn this before worrying about CI with Travis CI, hooks, or anything else.

[black big]*One Role One Repo*

Utilizing the one role one repo thought process for scalability and compatibility with Galaxy.

I am a firm believer you should store your roles in their own repo, I like to call this style One Role One Repo. I am often asked how to structure your Git repos when getting started with network automation so that you can easily scale and not have to make a bunch of changes later down the road. Some folks look at my strange when I advise them to structure their repos like this. They say well what if I we grow to having 1000 roles, we don't want to have 1000 repo’s. Yes you do actually!

A great presentation on this subject was given by Sam Doran a Senior Software Dev at Ansible/Red Hat during AnsibleFest London 2017. I always recommend folks go and watch that if they want to understand how to scale. You can find that presentation recording https://www.ansible.com/running-ansible-at-scale[here]

If you think about it... every role should be documented, permissioned, and shared on it’s own. What if you want to share your BGP roles with a certain department but they don’t need to see your OSPF and MPLS roles. How would you easily share those if they were all in the same repo.

Ansible Galaxy uses this same system, every role can be downloaded or cloned separately. Hopefully you may have some roles that you wish to share with the community. Also when you start to maintain these roles with a CI/CD mindset and start using tools like https://www.zuul-ci.org[ZUUL]. It all makes sense why they should live in their own repo’s.



[black big]*Dependencies*

When you create a role using the [red]#ansible-galaxy init# command it will automatically create a meta/main.yml file. This file is where you can list your role dependencies. In this case my role does require another role in order to function. If you read https://www.thenetwork.engineer/blog/utilize-ansible-for-opening-and-closing-tickets-with-servicenow-part3[Part 3] I introduced you to network-engine.


[black big]*Travis CI*

 I have been looking into adding some CI to this repo based on the repos of https://github.com/geerlingguy/ansible-role-firewall/blob/master/.travis.yml[GeerlingGuy] and https://github.com/nickrusso42518/racc/blob/master/.travis.yml[Nick Russo].

 This is a tricky subject when dealing with Network Automation. What we are trying to accomplish can sometimes be harder to emulate and test. For instance trying to use CI/CD against a change to an Ansible playbook that modifies BGP neighbors can be a beast to reproduce in a test environment. It seems like the trend currently is to automate a linting test against the YAML and call it good. I decided to use https://twitter.com/travisci[Travis CI] because it is a cloud based SaaS model and does not require me to spin up and maintain a server. I have been looking into https://www.zuul-ci.org[ZUUL] as it uses Ansible playbooks to drive the CI however it would require I stand up a server. I didn't want to take on that kind of task right now but would like to try this out in the future hopefully.

 I'm going to add CI to this the repo soon and create a follow up blog on this subject in the future.

[black big]*Pre Commit Hooks*

Hooks are very valuable when you start to contribute to a repo with business rules and production code.
A great place to start is with linting your YAML and Ansible. Another great example is a hook that searches for secrets
just in case someone tries to commit them by accident.

image:images/demo.gif[alt=demo,width=540,height=380]


https://docs.ansible.com/ansible-lint/[Ansible lint] is a command line checker tool.

https://yamllint.readthedocs.io/en/stable/quickstart.html#installing-yamllint[yaml lint] is a yaml linter.

https://github.com/awslabs/git-secrets[SecretsChecker] checks for accidental passwords or secrest left in the code your trying to commit.




[black big]*Stay tuned for more blogs where I will dig deeper into these individual subjects*




|===
|===


|===

|===
TheNetwork.Engineer - March 30 2019  -  Colin McCarthy
|===
